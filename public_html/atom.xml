<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Chocolate + Mint</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://chocomint.co/"/>
  <updated>2018-10-11T02:21:05.959Z</updated>
  <id>https://chocomint.co/</id>
  
  <author>
    <name>mint = Nguyen Duc Tin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Routing email with Exim</title>
    <link href="https://chocomint.co/2018/10/11/Routing_email_with_Exim/"/>
    <id>https://chocomint.co/2018/10/11/Routing_email_with_Exim/</id>
    <published>2018-10-11T02:59:15.000Z</published>
    <updated>2018-10-11T02:21:05.959Z</updated>
    
    <content type="html"><![CDATA[<p>Exim là một cung cụ MTA mạnh mẽ, cho phép chúng ta thực hiện gửi và nhận mail </p><h1 id="Tong-quan-qua-trinh-routing-email-va-transport-cua-Exim"><a href="#Tong-quan-qua-trinh-routing-email-va-transport-cua-Exim" class="headerlink" title="Tổng quan quá trình routing email và transport của Exim"></a>Tổng quan quá trình routing email và transport của Exim</h1><p>Đầu tiên, Exim sẽ phân biệt nơi cần gửi email tới dựa trên địa chỉ của người nhận. Exim sẽ phân loại ra 2 dạng địa chỉ là: </p><ul><li><code>Local address</code> - email sẽ được gửi tại localhost, các địa chỉ này đã tồn tại trên máy chủ (bằng file_append hoặc pipe_append)</li><li><code>Remote address</code> - email sẽ được gửi tới 1 host khác bằng giao thức SMTP</li></ul><p>Sau đó Exim sẽ lookup địa chỉ trong config của nó, nếu như hợp điều kiện nào đầu tiên, Exim sẽ sử dụng Routing đó cho việc gửi mail, nếu không trùng bất cứ điều kiện nào, Exim sẽ đưa email vào queue với trạng thái là <code>Unrouteable Address</code></p><p>Sau khi địa chỉ đã tìm được Routing của đời mình, Routing đó sẽ sử dụng Transport config để đẩy email đi. </p><p><img src="/images/routing_transport.png" alt="Email_Routing_Transport"></p><h2 id="Routing-local"><a href="#Routing-local" class="headerlink" title="Routing local"></a>Routing local</h2><p>Danh sách các domain được định nghĩa là local được định nghĩe trong file congig của Exim:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">domainlist local_domains = lsearch;/etc/virtual/domains</span><br></pre></td></tr></table></figure><p>-&gt; tất cả các domain có trong file <code>/etc/virtual/domains</code> sẽ được gửi vào local_address</p><p>Sau khi đã xác nhận được địa chỉ gửi nằm trong localhost, việc gửi mail cho các địa chỉ local tiếp túc được phân loại bởi block config Directors, tại đây Exim sẽ xác nhận rằng địa chỉ nhận tới có tồn tại trong danh sách User mà nó biết hay không, sau đó sẽ ghi nội dung email tới hòm thư của User đó hoặc chuyển tiếp vào pipe hay Alias tương ứng.</p><p>  <code>pipe_transport</code> là phương thức gửi mail bằng cách chuyển tiếp email đó sử dụng command trên hệ thống, nó như kiểu pipeline chúng ta hay sử dụng trên Shell ấy.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipe_transport | /usr/local/bin/procmail -d $local_part</span><br></pre></td></tr></table></figure><p>Ví dụ 1 block config của Exim, <code>driver</code> là gì: driver là định nghĩa thuộc tính hoạt động của một block code trong Exim, các config trong Exim được chia thành các block và mỗi 1 block sẽ có 1 định nghĩa driver, giống như là khai báo thuộc tính của 1 biến, int, var, char, float ..v.v</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virtual_localdelivery:</span><br><span class="line">  driver = appendfile </span><br><span class="line">  file = /path/to/mail/file</span><br></pre></td></tr></table></figure><p>Driver định nghĩa là sẽ ghi vào file, vậy nên trong block config này sẽ kèm theo một số cấu hình nữa liên quan đến việc ghi email vào file.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virtual_address_pipe:</span><br><span class="line">  driver = pipe</span><br><span class="line">  command = /usr/local/bin/command $host $local_part</span><br></pre></td></tr></table></figure></p><p>Còn đối với block này thì lại truyền email qua pipeline, cấu hình sẽ khác đi 1 chút. Lưu ý các cấu hình trên chỉ mang tính chất minh họa cho dễ hiểu :D</p><h3 id="Routing-to-remote-host"><a href="#Routing-to-remote-host" class="headerlink" title="Routing to remote host"></a>Routing to remote host</h3><p>Đối với các <code>remote_address</code>, block Routers sẽ quản lý cách các email này được gửi, cụ thể là Transport nào tương ứng.</p><p>Tại mỗi Route của exim, chúng ta sẽ định nghĩa cho Transport nào sẽ quản lý cách thức mà email sẽ được gửi đi, đối với các địa chỉ local thì thường sẽ dùng phương thức ghi vào file mailbox của user . <code>pipe_transport</code> là phương thức gửi mail bằng cách chuyển tiếp email đó sử dụng command trên hệ thống, nó như kiểu pipeline chúng ta hay sử dụng trên Shell ấy. </p><h5 id="Remote-transport-with-SMTP"><a href="#Remote-transport-with-SMTP" class="headerlink" title="Remote transport with SMTP"></a>Remote transport with SMTP</h5><p>Lookup SMTP khi dùng nhiều tài khoản SMTP </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Exim là một cung cụ MTA mạnh mẽ, cho phép chúng ta thực hiện gửi và nhận mail &lt;/p&gt;
&lt;h1 id=&quot;Tong-quan-qua-trinh-routing-email-va-transport
      
    
    </summary>
    
    
      <category term="email,exim" scheme="https://chocomint.co/tags/email-exim/"/>
    
  </entry>
  
  <entry>
    <title>How to corrupt and repair bootloader</title>
    <link href="https://chocomint.co/2018/05/21/How-to-corrupt-and-repair-bootloader-MBR/"/>
    <id>https://chocomint.co/2018/05/21/How-to-corrupt-and-repair-bootloader-MBR/</id>
    <published>2018-05-21T02:59:15.000Z</published>
    <updated>2018-05-22T15:38:47.700Z</updated>
    
    <content type="html"><![CDATA[<h1 id="How-to-corrupt-and-repair-bootloader"><a href="#How-to-corrupt-and-repair-bootloader" class="headerlink" title="How to corrupt and repair bootloader"></a><strong>How to corrupt and repair bootloader</strong></h1><p>Xin chào, mình là Mint,</p><p>Hôm nay chúng ta sẽ cùng thực hành phá hỏng booloader, sau đó sẽ tạo lại bootloader bằng grub</p><p><strong>Let’s do it</strong>  </p><h2 id="Xoa-du-lieu-tren-MBR"><a href="#Xoa-du-lieu-tren-MBR" class="headerlink" title="Xóa dữ liệu trên MBR"></a><strong>Xóa dữ liệu trên MBR</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# dd if=/dev/zero of=/dev/sda bs=446 count=1</span><br></pre></td></tr></table></figure><p><em>Boot sector có độ dài 512 bytes, trong đó 446 bytes đầu tiên là bootloader code, phần còn lại sẽ là partition table, chúng ta sẽ chỉ ghi đè 446 bytes đầu tiên mà thôi</em></p><blockquote><p>0x0000 to 0x01BD - First 446 bytes (boot loader code)<br>0x01BE to 0x01CD - Partition entry 1<br>0x01CE to 0x01DD - Partition entry 2<br>0x01DE to 0x01ED - Partition entry 3<br>0x01EE to 0x01FD - Partition entry 4<br>0x01FE to 0x01FF - Boot signature (55 AA)</p></blockquote><p>Reboot và tận hưởng </p><h2 id="Rescure-he-thong"><a href="#Rescure-he-thong" class="headerlink" title="Rescure hệ thống"></a><strong>Rescure hệ thống</strong></h2><ul><li>Enter rescure mode</li></ul><p>Khi sử dụng liveCD, CentOS có chế độ tự động phát hiện hệ điều hành cài đặt trên ổ cứng, tự động mount những phân vùng cần thiết để có 1 hệ thống hoàn chỉnh. Nếu sử dụng các distro khác hoặc hệ thống không tự động mount được, chúng ta sẽ phải mount bằng tay </p><p>Start <strong>shell</strong> </p><p>Tạo 1 thư mục để mount hệ thống<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /mnt/centos</span><br></pre></td></tr></table></figure></p><p>Sử dụng <code>fdisk</code> để kiểm tra xem các partition được cài đặt như thế nào</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# fdisk /dev/sda</span><br><span class="line"></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sda2         2099200    16777215     7339008   8e  Linux LVM</span><br></pre></td></tr></table></figure><p>Như vậy, <code>/dev/sda1</code> là phân vùng boot của hệ thống, <code>/dev/sda2</code> là phần còn lại <code>/</code><br>Trong trường hợp có nhiều partition hơn, chúng ta thực hiện mount các partition này vào các thư mục để xác định lần lượt các mountpoint, quan trọng là root <code>/</code> , hệ thống có thể có thêm <code>/home</code>, <code>/var</code>, <code>/blabla</code>. Xem file <code>/etc/fstab</code> để xác định.</p><p>Đối với Standard partition table, chúng ta có thể mount bằng lệnh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost ~]# mount /dev/sda2 /mnt/centos</span><br></pre></td></tr></table></figure></p><p>Đối với hệ thống sử dụng partition dạng LVM như trong bài lab này, sẽ tốn thêm 1 vài bước nữa </p><p>Xác định Volume Group  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# pvscan </span><br><span class="line">  PV /dev/sda2   VG centos          lvm2 [&lt;7.00 GiB / 0    free]</span><br><span class="line">  Total: 1 [&lt;7.00 GiB] / in use: 1 [&lt;7.00 GiB] / in no VG: 0 [0   ]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# lvscan </span><br><span class="line">  inactive            &apos;/dev/centos/swap&apos; [820.00 MiB] inherit</span><br><span class="line">  inactive            &apos;/dev/centos/root&apos; [&lt;6.20 GiB] inherit</span><br></pre></td></tr></table></figure><p>Do volume <code>/dev/centos/root</code> chưa active nên ta active trước khi mount </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vgchange -a y /dev/centos/root</span><br></pre></td></tr></table></figure><p>Tiếp theo là mount partition sử dụng lệnh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost ~]# mount /dev/centos/root /mnt/centos</span><br></pre></td></tr></table></figure><p>Vì <code>/boot</code> sử dụng định dạng Standard nên ta có thể mount dễ dàng bằng </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost ~]# mount /dev/sda1 /mnt/centos/boot</span><br></pre></td></tr></table></figure><p>Tiếp theo là mount <code>/dev</code>, <code>/proc</code>, <code>/sys</code> vào hệ thống mới </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost ~]# mount -t proc /proc /mnt/centos/proc</span><br><span class="line">[root@localhost ~]# mount -t sysfs /sys /mnt/centos/sys</span><br><span class="line">[root@localhost ~]# mount -o bind /dev /mnt/centos/dev</span><br></pre></td></tr></table></figure><p>Change root system </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# chroot /mnt/centos</span><br></pre></td></tr></table></figure><p>Reinstall GRUB</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# grub2-install /dev/sda</span><br></pre></td></tr></table></figure><blockquote><p>hoặc grub-install, dành cho Grub verison 1</p></blockquote><p>Exit và reboot </p><p><em>PS:// Nếu test trên VirtualBox hoặc KVM thì phải gỡ LiveCD ra sau khi reboot nhé, VirtualBox hiện tại bị bug chain-load <a href="https://www.virtualbox.org/ticket/2680" target="_blank" rel="noopener">Ticket 2680</a> </em></p><p>Xin chào and peace out!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;How-to-corrupt-and-repair-bootloader&quot;&gt;&lt;a href=&quot;#How-to-corrupt-and-repair-bootloader&quot; class=&quot;headerlink&quot; title=&quot;How to corrupt and r
      
    
    </summary>
    
    
      <category term="grub,bootloader" scheme="https://chocomint.co/tags/grub-bootloader/"/>
    
  </entry>
  
</feed>
